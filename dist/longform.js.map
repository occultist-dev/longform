{
  "version": 3,
  "sources": ["../lib/longform.ts"],
  "sourcesContent": ["import type { WorkingElement, WorkingChunk, ChunkType, WorkingFragment, FragmentType, ParsedResult } from \"./types.ts\";\r\n// exported for generated d.ts file to include types.\r\nexport * from './types.ts';\r\n\r\nconst sniffTestRe = /^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\\w\\-]+(?::[\\w\\-]+)?(?:[#.[][^\\n]+)?(::).*)|(?:  +(\\[).*)|(\\ \\ .*))$/gmi\r\n  , element1 = /((?:\\ \\ )+)? ?([\\w\\-]+(?::[\\w\\-]+)?)([#\\.\\[][^\\n]*)?::(?: ({{?|[^\\n]+))?/gmi\r\n  , directive1 = /((?:\\ \\ )+)? ?@([\\w][\\w\\-]+)(?::: ?([^\\n]+)?)?/gmi\r\n  , attribute1 = /((?:\\ \\ )+)\\[(\\w[\\w-]*(?::\\w[\\w-]*)?)(?:=([^\\n]+))?\\]/\r\n  , preformattedClose = /[ \\t]*}}?[ \\t]*/\r\n  , id1 = /((?:\\ \\ )+)?#(#)?([\\w\\-]+)( \\[)?/gmi\r\n  , idnt1 = /^(\\ \\ )+/\r\n  , text1 = /^((?:\\ \\ )+)([^ \\n][^\\n]*)$/i\r\n  , paramsRe = /(?:(#|\\.)([^#.\\[\\n]+)|(?:\\[(\\w[\\w\\-]*(?::\\w[\\w\\-]*)?)(?:=([^\\n\\]]+))?\\]))/g\r\n  , refRe = /#\\[([\\w\\-]+)\\]/g\r\n  , voids = new Set(['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'link', 'meta', 'param', 'source', 'track', 'wrb']);\r\n\r\nlet m1: RegExpExecArray | null\r\n  , m2: RegExpExecArray | null;\r\n\r\n\r\nfunction makeElement(indent: number = 0): WorkingElement {\r\n  return {\r\n    indent,\r\n    html: '',\r\n    attrs: {},\r\n  };\r\n}\r\n\r\nfunction makeChunk(type: ChunkType = 'parsed'): WorkingChunk {\r\n  return {\r\n    type,\r\n    html: '',\r\n    els: [],\r\n  };\r\n}\r\n\r\nfunction makeFragment(type: FragmentType = 'bare'): WorkingFragment {\r\n  return {\r\n    type,\r\n    html: '',\r\n    els: [],\r\n    chunks: [],\r\n    refs: [],\r\n  };\r\n}\r\n\r\n/**\r\n * Parses a longform document into a object containing the root and fragments\r\n * in the output format.\r\n *\r\n * @param {string} doc - The longform document to parse.\r\n * @returns {ParsedResult}\r\n */\r\nexport function longform(doc: string, debug: (...d: unknown[]) => void = () => {}): ParsedResult {\r\n  let skipping: boolean = false\r\n    , textIndent: number | null = null\r\n    , verbatimSerialize: boolean = true\r\n    , verbatimIndent: number | null = null\r\n    , verbatimFirst: boolean = false\r\n    , element: WorkingElement = makeElement()\r\n    , chunk: WorkingChunk | null = makeChunk()\r\n    , fragment: WorkingFragment = makeFragment()\r\n    // the root fragment\r\n    , root: WorkingFragment | null = null\r\n    // ids of claimed fragments\r\n  const claimed: Set<string> = new Set()\r\n    // parsed fragments\r\n    , parsed: Map<string, WorkingFragment> = new Map()\r\n    , output: ParsedResult = Object.create(null);\r\n\r\n  output.fragments = Object.create(null);\r\n  \r\n  \r\n  /**\r\n   * Closes any current in progress element definition\r\n   * and creates a new working element.\r\n   */\r\n  function applyIndent(targetIndent: number) {\r\n    if (element.tag != null) {\r\n      const root = fragment.type === 'range'\r\n        ? targetIndent < 2\r\n        : fragment.html === ''\r\n      ;\r\n\r\n      fragment.html += `<${element.tag}`\r\n\r\n      if (root) {\r\n        if (fragment.type === 'root') {\r\n          fragment.html += ` data-lf-root`;\r\n        } else if (fragment.type === 'bare' || fragment.type === 'range') {\r\n          fragment.html += ` data-lf=\"${fragment.id}\"`;\r\n        }\r\n      }\r\n\r\n      if (element.id != null) {\r\n        fragment.html += ' id=\"' + element.id + '\"';\r\n      }\r\n\r\n      if (element.class != null) {\r\n        fragment.html += ' class=\"' + element.class + '\"';\r\n      }\r\n\r\n      for (const attr of Object.entries(element.attrs)) {\r\n        if (attr[1] == null) {\r\n          fragment.html += ' ' + attr[0]\r\n        } else {\r\n          fragment.html += ` ${attr[0]}=\"${attr[1]}\"`;\r\n        }\r\n      }\r\n\r\n      fragment.html += '>';\r\n\r\n      if (!voids.has(element.tag as string) && element.text != null) {\r\n        fragment.html += element.text;\r\n      }\r\n\r\n      if (\r\n        !voids.has(element.tag as string)\r\n      ) {\r\n        fragment.els.push(element);\r\n      }\r\n    }\r\n\r\n    if (targetIndent <= element.indent) {\r\n      element = makeElement(targetIndent);\r\n\r\n      while (\r\n        fragment.els.length !== 0 && (\r\n          targetIndent == null ||\r\n          fragment.els[fragment.els.length - 1].indent !== targetIndent - 1\r\n        )\r\n      ) {\r\n        const element = fragment.els.pop();\r\n\r\n        fragment.html += `</${element?.tag}>`;\r\n      }\r\n\r\n      if (targetIndent === 0) {\r\n        debug(0, '<', fragment.type, fragment.id);\r\n        if (fragment.type === 'root') {\r\n          root = fragment;\r\n        } else {\r\n          parsed.set(fragment.id, fragment);\r\n        }\r\n\r\n        fragment = makeFragment();\r\n      }\r\n    } else {\r\n      element = makeElement(targetIndent)\r\n    }\r\n  }\r\n\r\n  while ((m1 = sniffTestRe.exec(doc))) {\r\n    if (m1[1] === '--') {\r\n      continue;\r\n    }\r\n\r\n    // If this is a script tag or preformatted block\r\n    // we want to retain the intended formatting less\r\n    // the indent. Preformatting can apply to any element\r\n    // by ending the declaration with `:: {`.\r\n    if (verbatimIndent != null) {\r\n      // inside a script or preformatted block\r\n      idnt1.lastIndex = 0;\r\n      m2 = idnt1.exec(m1[0]);\r\n      const indent = m2 == null\r\n        ? null\r\n        : m2[0].length / 2;\r\n\r\n      if (m2 == null || indent as number <= verbatimIndent) {\r\n        fragment.html += '\\n';\r\n        debug(indent, '}', m2?.[0]);\r\n\r\n        applyIndent(indent);\r\n        verbatimIndent = null;\r\n        verbatimFirst = false;\r\n        textIndent = indent;\r\n\r\n        if (preformattedClose.test(m1[0])) {\r\n          continue;\r\n        }\r\n      } else {\r\n        const line = m1[0].replace('  '.repeat(verbatimIndent + 1), '');\r\n        debug(indent, '{', line);\r\n\r\n        if (element.tag != null) {\r\n          applyIndent(indent as number);\r\n        }\r\n\r\n        if (verbatimFirst) {\r\n          verbatimFirst = false;\r\n        } else {\r\n          fragment.html += '\\n';\r\n        }\r\n        \r\n        if (verbatimSerialize) {\r\n          fragment.html += line\r\n            .replace(/&/g, '&amp;')\r\n            .replace(/</g, '&lt;')\r\n            .replace(/>/g, '&gt;')\r\n            .replace(/\"/g, '&quot;')\r\n            .replace(/'/g, '&#039;');\r\n        } else {\r\n          fragment.html += line;\r\n        }\r\n\r\n        continue;\r\n      }\r\n    }\r\n\r\n    if (m1[0].trim() === '') {\r\n      continue;\r\n    }\r\n\r\n    switch (m1[2] ?? m1[3] ?? m1[4]) {\r\n      // deno-lint-ignore no-fallthrough\r\n      case '#': {\r\n        id1.lastIndex = 0;\r\n        m2 = id1.exec(m1[0]);\r\n\r\n        if (m2 != null) {\r\n          const indent = (m2[1]?.length ?? 0) / 2;\r\n\r\n          if (element.tag != null || textIndent != null) {\r\n            applyIndent(indent);\r\n            textIndent = null;\r\n          }\r\n\r\n          debug(indent, 'id', m2[2], m2[3], m2[4]);\r\n\r\n          fragment.id = m2[3];\r\n\r\n          if (indent === 0) {\r\n            if (m2[4] != null) {\r\n              fragment.type = 'range';\r\n            } else if (m2[2] != null) {\r\n              fragment.type = 'bare';\r\n            } else {\r\n              fragment.type = 'embed';\r\n              element.id = fragment.id;\r\n            }\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n      case '@':\r\n      case '[':\r\n      // deno-lint-ignore no-fallthrough\r\n      case '::': {\r\n        element1.lastIndex = 0;\r\n        // fall through if m1[3] is a # or @\r\n        m2 = m1[2] ?? m1[4] != null\r\n           ? null\r\n           : element1.exec(m1[0]);\r\n\r\n        // if null then invalid element selector\r\n        // allow the default text case to handle\r\n        if (m2 != null) {\r\n          const indent = (m2[1]?.length ?? 0) / 2\r\n              , tg = m2[2]\r\n              , ar = m2[3]\r\n              , pr = m2[4] === '{' || m2[4] === '{{'\r\n          const tx = pr ? null : m2[4]\r\n\r\n          debug(indent, 'e', tg, pr, tx);\r\n\r\n          if (\r\n            element.tag != null ||\r\n            element.indent > indent\r\n          ) {\r\n            applyIndent(indent);\r\n          }\r\n\r\n          element.indent = indent;\r\n          element.tag = tg;\r\n\r\n          textIndent = null;\r\n          \r\n          if (indent === 0 && fragment.id == null) {\r\n            if (root != null) {\r\n              skipping = true;\r\n            } else {\r\n              fragment.type = 'root';\r\n              root = fragment;\r\n            }\r\n          }\r\n          \r\n          if (ar != null) {\r\n            debug(indent, 'a', ar);\r\n            while ((m2 = paramsRe.exec(ar))) {\r\n              if (m2[1] === '#') {\r\n                element.id = m2[2];\r\n              } else if (m2[1] === '.') {\r\n                if (element.class == null) {\r\n                  element.class = m2[2];\r\n                } else {\r\n                  element.class += ' ' + m2[2];\r\n                }\r\n              } else {\r\n                if (m2[3] === 'id') {\r\n                  if (element.id == null) {\r\n                    element.id = m2[4];\r\n                  }\r\n                } else if (m2[3] === 'class') {\r\n                  if (element.class == null) {\r\n                    element.class = m2[4]\r\n                  } else {\r\n                    element.class += ' ' + m2[4]\r\n                  }\r\n                } else {\r\n                  element.attrs[m2[3]] = m2[4];\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          if (!pr && tx != null) {\r\n            element.text = tx;\r\n          } else if (pr) {\r\n            verbatimFirst = true;\r\n            verbatimIndent = indent;\r\n            verbatimSerialize = m2[4] === '{';\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        attribute1.lastIndex = 0;\r\n        m2 = m1[2] != null\r\n           ? null\r\n           : attribute1.exec(m1[0]);\r\n\r\n        if (m2 != null && element.tag != null) {\r\n          debug('a', m2[2], m2[3]);\r\n\r\n          if (m2[2] === 'id') {\r\n            if (element.id == null) {\r\n              element.id = m2[3].trim();\r\n            }\r\n          } else if (m2[2] === 'class') {\r\n            if (element.class != null) {\r\n              element.class += ' ' + m2[3].trim();\r\n            } else {\r\n              element.class = m2[3].trim();\r\n            }\r\n          } else if (element.attrs[m2[2]] != null) {\r\n            element.attrs[m2[2]] += m2[3];\r\n          } else {\r\n            element.attrs[m2[2]] = m2[3];\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        directive1.lastIndex = 0;\r\n        m2 = m1[3] != null\r\n            ? null \r\n            : directive1.exec(m1[0]);\r\n\r\n        if (m2 != null) {\r\n          const indent = (m2[1]?.length ?? 0) / 2;\r\n\r\n          if (element.tag != null || textIndent != null) {\r\n            applyIndent(indent);\r\n          }\r\n\r\n          debug(indent, 'd', m2[2], m2[3]);\r\n\r\n          switch (m2[2]) {\r\n            case 'doctype': {\r\n              fragment.html += `<!doctype ${m2[3] ?? 'html'}>`;\r\n              break;\r\n            }\r\n            case 'xml': {\r\n              fragment.html += `<?xml ${m2[3] ?? 'version=\"1.0\" encoding=\"UTF-8\"'}?>`;\r\n              break;\r\n            }\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n      }\r\n      default: {\r\n        m2 = text1.exec(m1[0]) as RegExpExecArray;\r\n\r\n        if (m2 == null) {\r\n          break;\r\n        }\r\n        const indent = m2[1].length / 2;\r\n        const tx = m2[2].trim();\r\n\r\n\r\n        debug(indent, 't', m2[2]);\r\n\r\n        if (element.tag != null) {\r\n          applyIndent(indent);\r\n\r\n          fragment.html += tx;\r\n        } else {\r\n          fragment.html += ' ' + tx;\r\n        }\r\n\r\n        textIndent = indent;\r\n\r\n        while ((m2 = refRe.exec(tx))) {\r\n          const start = fragment.html.length + m2.index - tx.length;\r\n\r\n          fragment.refs.push({\r\n            id: m2[1],\r\n            start,\r\n            end: start + m2[0].length,\r\n          });\r\n        }\r\n\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  applyIndent(0);\r\n\r\n  const arr = Array.from(parsed.values());\r\n\r\n  function flatten(fragment: WorkingFragment): WorkingFragment {\r\n    // work backwards so we don't change the html string length\r\n    // for the later replacements\r\n    for (let j = fragment.refs.length - 1; j >= 0; j--) {\r\n      const ref = fragment.refs[j];\r\n\r\n      if (claimed.has(ref.id) || !parsed.has(ref.id)) {\r\n        fragment.html = fragment.html.slice(0, ref.start)\r\n          + fragment.html.slice(ref.end)\r\n      } else {\r\n        const child = flatten(parsed.get(ref.id));\r\n\r\n        fragment.html = fragment.html.slice(0, ref.start)\r\n          + child.html\r\n          + fragment.html.slice(ref.end);\r\n\r\n        if (child.type === 'embed') {\r\n          claimed.add(child.id)\r\n        }\r\n      }\r\n    }\r\n\r\n    fragment.refs = [];\r\n\r\n    return fragment;\r\n  }\r\n\r\n  for (let i = 0; i < parsed.size + 1; i++) {\r\n    let fragment: WorkingFragment;\r\n    \r\n    if (i === 0 && root == null) {\r\n      continue;\r\n    } else if (i === 0) {\r\n      fragment = root;\r\n    } else {\r\n      fragment = arr[i - 1];\r\n    }\r\n\r\n    if (fragment.refs.length === 0) {\r\n      continue;\r\n    }\r\n\r\n    flatten(fragment)\r\n  }\r\n\r\n  if (root?.html != null) {\r\n    output.root = root.html;\r\n    output.selector = `[data-lf-root]`;\r\n  }\r\n\r\n  for (let i = 0; i < arr.length; i++) {\r\n    let selector: string;\r\n    const fragment = arr[i];\r\n\r\n    if (fragment == null || claimed.has(fragment.id)) {\r\n      continue;\r\n    }\r\n\r\n    if (fragment.type === 'embed') {\r\n      selector = `[id=${fragment.id}]`;\r\n    } else if (fragment.type === 'bare') {\r\n      selector = `[data-lf=${fragment.id}]`;\r\n    } else if (fragment.type === 'range') {\r\n      selector = `[data-lf=${fragment.id}]`;\r\n    }\r\n\r\n    output.fragments[fragment.id] = {\r\n      id: fragment.id,\r\n      selector,\r\n      type: fragment.type as 'embed' | 'bare' | 'range',\r\n      html: fragment.html,\r\n    };\r\n  }\r\n\r\n  return output;\r\n}\r\n"],
  "mappings": "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",
  "names": ["root", "element", "fragment"]
}
