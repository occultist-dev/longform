export*from"./types";export*from"./types";const B=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +(\[).*)|(\ \ .*))$/gmi,M=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({{?|[^\n]+))?/gmi,O=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,P=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,D=/[ \t]*}}?[ \t]*/,z=/((?:\ \ )+)?#(#)?([\w\-]+)( \[)?/gmi,q=/^(\ \ )+/,G=/^((?:\ \ )+)([^ \n][^\n]*)$/i,H=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,J=/#\[([\w\-]+)\]/g,L=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let r,e;function y(c=0){return{indent:c,html:"",attrs:{}}}function K(c="parsed"){return{type:c,html:"",els:[]}}function N(c="bare"){return{type:c,html:"",els:[],chunks:[],refs:[]}}export function longform(c,a=()=>{}){var E,F,$,R,v,C,T,j,A,S,I;let U=!1,m=null,w=!0,h=null,p=!1,t=y(),Q=K(),n=N(),u=null;const k=new Set,d=new Map,g=Object.create(null);g.fragments=Object.create(null);function f(l){if(t.tag!=null){const s=n.html==="";n.html+=`<${t.tag}`,s&&(n.type==="root"?n.html+=" data-lf-root":(n.type==="bare"||n.type==="range")&&(console.log("ELEMENT",t),n.html+=` data-lf="${t.id}"`)),t.id!=null&&(n.html+=' id="'+t.id+'"'),t.class!=null&&(n.html+=' class="'+t.class+'"');for(const i of Object.entries(t.attrs))i[1]==null?n.html+=" "+i[0]:n.html+=` ${i[0]}="${i[1]}"`;n.html+=">",!L.has(t.tag)&&t.text!=null&&(n.html+=t.text),L.has(t.tag)||n.els.push(t)}if(l<=t.indent){for(t=y(l);n.els.length!==0&&(l==null||n.els[n.els.length-1].indent!==l-1);){const s=n.els.pop();n.html+=`</${s==null?void 0:s.tag}>`}l===0&&(a(0,"<",n.type,n.id),n.type==="root"?u=n:d.set(n.id,n),n=N())}else t=y(l)}for(;r=B.exec(c);)if(r[1]!=="--"){if(h!=null){q.lastIndex=0,e=q.exec(r[0]);const l=e==null?null:e[0].length/2;if(e==null||l<=h){if(n.html+=`
`,a(l,"}",e==null?void 0:e[0]),f(l),h=null,p=!1,m=l,D.test(r[0]))continue}else{const s=r[0].replace("  ".repeat(h+1),"");a(l,"{",s),t.tag!=null&&f(l),p?p=!1:n.html+=`
`,w?n.html+=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):n.html+=s;continue}}if(r[0].trim()!=="")switch((F=(E=r[2])!=null?E:r[3])!=null?F:r[4]){case"#":if(z.lastIndex=0,e=z.exec(r[0]),e!=null){const l=((R=($=e[1])==null?void 0:$.length)!=null?R:0)/2;(t.tag!=null||m!=null)&&(f(l),m=null),a(l,"id",e[2],e[3],e[4]),n.id=e[3],l===0&&(e[4]!=null?n.type="range":e[2]!=null?n.type="bare":(n.type="embed",t.id=n.id));break}case"@":case"[":case"::":{if(M.lastIndex=0,e=((v=r[2])!=null?v:r[4]!=null)?null:M.exec(r[0]),e!=null){const l=((T=(C=e[1])==null?void 0:C.length)!=null?T:0)/2,s=e[2],i=e[3],o=e[4]==="{"||e[4]==="{{",b=o?null:e[4];if(a(l,"e",s,o,b),(t.tag!=null||t.indent>l)&&f(l),t.indent=l,t.tag=s,m=null,l===0&&n.id==null&&(u!=null?U=!0:(n.type="root",u=n)),i!=null)for(a(l,"a",i);e=H.exec(i);)e[1]==="#"?t.id=e[2]:e[1]==="."?t.class==null?t.class=e[2]:t.class+=" "+e[2]:e[3]==="id"?t.id==null&&(t.id=e[4]):e[3]==="class"?t.class==null?t.class=e[4]:t.class+=" "+e[4]:t.attrs[e[3]]=e[4];!o&&b!=null?t.text=b:o&&(p=!0,h=l,w=e[4]==="{");break}if(P.lastIndex=0,e=r[2]!=null?null:P.exec(r[0]),e!=null&&t.tag!=null){a("a",e[2],e[3]),e[2]==="id"?t.id==null&&(t.id=e[3].trim()):e[2]==="class"?t.class!=null?t.class+=" "+e[3].trim():t.class=e[3].trim():t.attrs[e[2]]!=null?t.attrs[e[2]]+=e[3]:t.attrs[e[2]]=e[3];break}if(O.lastIndex=0,e=r[3]!=null?null:O.exec(r[0]),e!=null){const l=((A=(j=e[1])==null?void 0:j.length)!=null?A:0)/2;switch((t.tag!=null||m!=null)&&f(l),a(l,"d",e[2],e[3]),e[2]){case"doctype":{n.html+=`<!doctype ${(S=e[3])!=null?S:"html"}>`;break}case"xml":{n.html+=`<?xml ${(I=e[3])!=null?I:'version="1.0" encoding="UTF-8"'}?>`;break}}break}}default:{if(e=G.exec(r[0]),e==null)break;const l=e[1].length/2,s=e[2].trim();for(a(l,"t",e[2]),t.tag!=null?(f(l),n.html+=s):n.html+=" "+s,m=l;e=J.exec(s);){const i=n.html.length+e.index-s.length;n.refs.push({id:e[1],start:i,end:i+e[0].length})}break}}}f(0);const x=Array.from(d.values());function W(l){for(let s=l.refs.length-1;s>=0;s--){const i=l.refs[s];if(k.has(i.id)||!d.has(i.id))l.html=l.html.slice(0,i.start)+l.html.slice(i.end);else{const o=W(d.get(i.id));l.html=l.html.slice(0,i.start)+o.html+l.html.slice(i.end),o.type==="embed"&&k.add(o.id)}}return l.refs=[],l}for(let l=0;l<d.size+1;l++){let s;l===0&&u==null||(l===0?s=u:s=x[l-1],s.refs.length!==0&&W(s))}(u==null?void 0:u.html)!=null&&(g.root=u.html,g.selector="[data-lf-root]");for(let l=0;l<x.length;l++){let s;const i=x[l];i==null||k.has(i.id)||(i.type==="embed"?s=`[id=${i.id}]`:i.type==="bare"?s=`[data-lf=${i.id}]`:i.type==="range"&&(s=`[data-lf=${i.id}]`),g.fragments[i.id]={id:i.id,selector:s,type:i.type,html:i.html})}return g}
//# sourceMappingURL=longform.min.js.map
