const R=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +([\["]).*)|(\ \ .*))$/gmi,q=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({{?|[^\n]+))?/gmi,L=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,U=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,K=/[ \t]*}}?[ \t]*/,W=/((?:\ \ )+)?#(#)?([\w\-]+)(?: ([\["]))?/gmi,B=/^(\ \ )+/,N=/^((?:\ \ )+)([^ \n][^\n]*)$/i,Q=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,V=/#\[([\w\-]+)\]/g,X=/([&<>"'#\[\]{}])/g,$=/^(\ \ )?([^\n]*)$/gmi,D=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let r,e,G;const Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","#":"&num;","[":"&lbrak;","]":"&rbrak;","{":"&rbrace;","}":"&lbrace;"};function H(u){return u.replace(X,a=>{var d;return(d=Y[a])!=null?d:""})}function E(u=0){return{indent:u,html:"",attrs:{}}}function Z(u="parsed"){return{type:u,html:"",els:[]}}function J(u="bare"){return{type:u,html:"",template:!1,els:[],chunks:[],refs:[]}}export function longform(u,a=()=>{}){var T,C,I,j,A,P,S,O,_,z,M;let d=!1,c=null,k=!0,f=null,g=!1,n=E(),b=Z(),l=J(),m=null;const y=new Set,x=new Map,p=Object.create(null);p.fragments=Object.create(null),p.templates=Object.create(null);function o(t){if(n.tag!=null){const i=l.type==="range"?t<2:l.html==="";l.html+=`<${n.tag}`,i&&(l.type==="root"?l.html+=" data-lf-root":(l.type==="bare"||l.type==="range")&&(l.html+=` data-lf="${l.id}"`)),n.id!=null&&(l.html+=' id="'+n.id+'"'),n.class!=null&&(l.html+=' class="'+n.class+'"');for(const s of Object.entries(n.attrs))s[1]==null?l.html+=" "+s[0]:l.html+=` ${s[0]}="${s[1]}"`;l.html+=">",!D.has(n.tag)&&n.text!=null&&(l.html+=n.text),D.has(n.tag)||l.els.push(n)}if(t<=n.indent){for(n=E(t);l.els.length!==0&&(t==null||l.els[l.els.length-1].indent!==t-1);){const i=l.els.pop();l.html+=`</${i==null?void 0:i.tag}>`}t===0&&(a(0,"<",l.type,l.id),l.template?p.templates[l.id]=l.html:l.type==="root"?m=l:x.set(l.id,l),l=J())}else n=E(t)}for(;r=R.exec(u);)if(r[1]!=="--"){if(l.template&&(l.html+=r[0]),f!=null){B.lastIndex=0,e=B.exec(r[0]);const t=e==null?null:e[0].length/2;if(e==null||t<=f){if(l.html+=`
`,a(t,"}",e==null?void 0:e[0]),o(t),f=null,g=!1,c=t,K.test(r[0]))continue}else{const i=r[0].replace("  ".repeat(f+1),"");a(t,"{",i),n.tag!=null&&o(t),g?g=!1:l.html+=`
`,k?l.html+=H(i):l.html+=i;continue}}if(r[0].trim()!=="")switch((C=(T=r[2])!=null?T:r[3])!=null?C:r[4]){case"#":if(W.lastIndex=0,e=W.exec(r[0]),e!=null){const t=((j=(I=e[1])==null?void 0:I.length)!=null?j:0)/2;(n.tag!=null||c!=null)&&(o(t),c=null),a(t,"id",e[2],e[3],e[4]),l.id=e[3],t===0&&(e[4]=="["?l.type="range":e[4]==='"'?l.type="text":e[2]!=null?l.type="bare":(l.type="embed",n.id=l.id));break}case"@":case"[":case"::":{if(q.lastIndex=0,e=((A=r[2])!=null?A:r[4]!=null)?null:q.exec(r[0]),e!=null){const t=((S=(P=e[1])==null?void 0:P.length)!=null?S:0)/2,i=e[2],s=e[3],h=e[4]==="{"||e[4]==="{{",F=h?null:e[4];if(a(t,"e",i,h,F),(n.tag!=null||n.indent>t)&&o(t),n.indent=t,n.tag=i,c=null,t===0&&l.id==null&&(m!=null?d=!0:(l.type="root",m=l)),s!=null)for(a(t,"a",s);e=Q.exec(s);)e[1]==="#"?n.id=e[2]:e[1]==="."?n.class==null?n.class=e[2]:n.class+=" "+e[2]:e[3]==="id"?n.id==null&&(n.id=e[4]):e[3]==="class"?n.class==null?n.class=e[4]:n.class+=" "+e[4]:n.attrs[e[3]]=e[4];!h&&F!=null?n.text=F:h&&(g=!0,f=t,k=e[4]==="{");break}if(U.lastIndex=0,e=r[2]!=null?null:U.exec(r[0]),e!=null&&n.tag!=null){a("a",e[2],e[3]),e[2]==="id"?n.id==null&&(n.id=e[3].trim()):e[2]==="class"?n.class!=null?n.class+=" "+e[3].trim():n.class=e[3].trim():n.attrs[e[2]]!=null?n.attrs[e[2]]+=e[3]:n.attrs[e[2]]=e[3];break}if(L.lastIndex=0,e=r[3]!=null?null:L.exec(r[0]),e!=null){const t=((_=(O=e[1])==null?void 0:O.length)!=null?_:0)/2;switch((n.tag!=null||c!=null)&&o(t),a(t,"d",e[2],e[3]),e[2]){case"doctype":{l.html+=`<!doctype ${(z=e[3])!=null?z:"html"}>`;break}case"xml":{l.html+=`<?xml ${(M=e[3])!=null?M:'version="1.0" encoding="UTF-8"'}?>`;break}case"template":{let i=!1;for(l.template=t===0,$.lastIndex=R.lastIndex;e=$.exec(u);){if(e[1]==null&&!i)G=W.exec(e[0]),l.id=G[3],l.html+=e[0];else if(e[1]==null&&i){R.lastIndex=$.lastIndex-1,o(0);break}else l.html+=`
`+e[0];i=!0}}}break}}default:{if(e=N.exec(r[0]),e==null)break;const t=e[1].length/2,i=e[2].trim();for(a(t,"t",e[2]),n.tag!=null?(o(t),l.html+=i):l.type==="text"&&l.html===""?l.html+=i:l.html+=" "+i,c=t;e=V.exec(i);){const s=l.html.length+e.index-i.length;l.refs.push({id:e[1],start:s,end:s+e[0].length})}break}}}o(0);const w=Array.from(x.values());function v(t){for(let i=t.refs.length-1;i>=0;i--){const s=t.refs[i];if(y.has(s.id)||!x.has(s.id))t.html=t.html.slice(0,s.start)+t.html.slice(s.end);else{const h=v(x.get(s.id));t.html=t.html.slice(0,s.start)+h.html+t.html.slice(s.end),h.type==="embed"&&y.add(h.id)}}return t.refs=[],t}for(let t=0;t<x.size+1;t++){let i;t===0&&m==null||(t===0?i=m:i=w[t-1],i.refs.length!==0&&v(i))}(m==null?void 0:m.html)!=null&&(p.root=m.html,p.selector="[data-lf-root]");for(let t=0;t<w.length;t++){let i;const s=w[t];s==null||y.has(s.id)||(s.type==="embed"?i=`[id=${s.id}]`:s.type==="bare"?i=`[data-lf=${s.id}]`:s.type==="range"&&(i=`[data-lf=${s.id}]`),p.fragments[s.id]={id:s.id,selector:i,type:s.type,html:s.html})}return p}const ee=/(?:#{([\w][\w\-_]*)})|(?:#\[([\w][\w\-_]+)\])/g;export function processTemplate(u,a,d){var f,g;const c=d.templates[u];if(c==null)return null;const k=c.replace(ee,(n,b,l)=>{if(l!=null){const m=d.fragments[l];return m==null?"":m.html}return a[b]!=null?H(a[b].toString()):""});return(g=(f=longform(k).fragments[u])==null?void 0:f.html)!=null?g:null}
//# sourceMappingURL=longform.min.js.map
