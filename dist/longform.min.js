const W=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +([\["]).*)|(\ \ .*))$/gmi,L=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({{?|[^\n]+))?/gmi,U=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,B=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,K=/[ \t]*}}?[ \t]*/,y=/((?:\ \ )+)?#(#)?([\w\-]+)(?: ([\["]))?/gmi,D=/^(\ \ )+/,N=/^((?:\ \ )+)([^ \n][^\n]*)$/i,Q=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,V=/#\[([\w\-]+)\]/g,X=/([&<>"'#\[\]{}])/g,$=/^(\ \ )?([^\n]+)$/gmi,G=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let r,e,E;const Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};function H(u){return u.replace(X,a=>{var g;return(g=Y[a])!=null?g:a})}function v(u=0){return{indent:u,html:"",attrs:{}}}function Z(u="parsed"){return{type:u,html:"",els:[]}}function J(u="bare"){return{type:u,html:"",template:!1,els:[],chunks:[],refs:[]}}export function longform(u,a=()=>{}){var C,I,j,A,O,S,P,_,z,M,q;let g=!1,f=null,p=!0,c=null,x=!1,n=v(),b=Z(),l=J(),m=null;const w=new Set,k=new Map,h=Object.create(null);h.fragments=Object.create(null),h.templates=Object.create(null);function o(t){if(n.tag!=null){const i=l.type==="range"?t<2:l.html==="";l.html+=`<${n.tag}`,i&&(l.type==="root"?l.html+=" data-lf-root":(l.type==="bare"||l.type==="range")&&(l.html+=` data-lf="${l.id}"`)),n.id!=null&&(l.html+=' id="'+n.id+'"'),n.class!=null&&(l.html+=' class="'+n.class+'"');for(const s of Object.entries(n.attrs))s[1]==null?l.html+=" "+s[0]:l.html+=` ${s[0]}="${s[1]}"`;l.html+=">",!G.has(n.tag)&&n.text!=null&&(l.html+=n.text),G.has(n.tag)||l.els.push(n)}if(t<=n.indent){for(n=v(t);l.els.length!==0&&(t==null||l.els[l.els.length-1].indent!==t-1);){const i=l.els.pop();l.html+=`</${i==null?void 0:i.tag}>`}t===0&&(a(0,"<",l.type,l.id),l.template?h.templates[l.id]=l.html:l.type==="root"?m=l:k.set(l.id,l),l=J())}else n=v(t)}for(;r=W.exec(u);)if(r[1]!=="--"){if(l.template&&(l.html+=r[0]),c!=null){D.lastIndex=0,e=D.exec(r[0]);const t=e==null?null:e[0].length/2;if(e==null||t<=c){if(l.html+=`
`,a(t,"}",e==null?void 0:e[0]),o(t),c=null,x=!1,f=t,K.test(r[0]))continue}else{const i=r[0].replace("  ".repeat(c+1),"");a(t,"{",i),n.tag!=null&&o(t),x?x=!1:l.html+=`
`,p?l.html+=H(i):l.html+=i;continue}}if(r[0].trim()!=="")switch((I=(C=r[2])!=null?C:r[3])!=null?I:r[4]){case"#":if(y.lastIndex=0,e=y.exec(r[0]),e!=null){const t=((A=(j=e[1])==null?void 0:j.length)!=null?A:0)/2;(n.tag!=null||f!=null)&&(o(t),f=null),a(t,"id",e[2],e[3],e[4]),l.id=e[3],t===0&&(e[4]=="["?l.type="range":e[4]==='"'?l.type="text":e[2]!=null?l.type="bare":(l.type="embed",n.id=l.id));break}case"@":case"[":case"::":{if(L.lastIndex=0,e=((O=r[2])!=null?O:r[4]!=null)?null:L.exec(r[0]),e!=null){const t=((P=(S=e[1])==null?void 0:S.length)!=null?P:0)/2,i=e[2],s=e[3],d=e[4]==="{"||e[4]==="{{",R=d?null:e[4];if(a(t,"e",i,d,R),(n.tag!=null||n.indent>t)&&o(t),n.indent=t,n.tag=i,f=null,t===0&&l.id==null&&(m!=null?g=!0:(l.type="root",m=l)),s!=null)for(a(t,"a",s);e=Q.exec(s);)e[1]==="#"?n.id=e[2]:e[1]==="."?n.class==null?n.class=e[2]:n.class+=" "+e[2]:e[3]==="id"?n.id==null&&(n.id=e[4]):e[3]==="class"?n.class==null?n.class=e[4]:n.class+=" "+e[4]:n.attrs[e[3]]=e[4];!d&&R!=null?n.text=R:d&&(x=!0,c=t,p=e[4]==="{");break}if(B.lastIndex=0,e=r[2]!=null?null:B.exec(r[0]),e!=null&&n.tag!=null){a("a",e[2],e[3]),e[2]==="id"?n.id==null&&(n.id=e[3].trim()):e[2]==="class"?n.class!=null?n.class+=" "+e[3].trim():n.class=e[3].trim():n.attrs[e[2]]!=null?n.attrs[e[2]]+=e[3]:n.attrs[e[2]]=e[3];break}if(U.lastIndex=0,e=r[3]!=null?null:U.exec(r[0]),e!=null){const t=((z=(_=e[1])==null?void 0:_.length)!=null?z:0)/2;switch((n.tag!=null||f!=null)&&o(t),a(t,"d",e[2],e[3]),e[2]){case"doctype":{l.html+=`<!doctype ${(M=e[3])!=null?M:"html"}>`;break}case"xml":{l.html+=`<?xml ${(q=e[3])!=null?q:'version="1.0" encoding="UTF-8"'}?>`;break}case"template":{let i=!1;for(l.template=t===0,$.lastIndex=W.lastIndex;e=$.exec(u);)if(e[1]==null&&!i&&l.id==null)y.lastIndex=0,E=y.exec(e[0]),E!=null&&(l.id=E[3]),l.html+=e[0];else if(e[1]==null&&i){W.lastIndex=$.lastIndex-e[0].length;break}else l.html+=`
`+e[0],e[1]!=null&&(i=!0);o(0)}}break}}default:{if(e=N.exec(r[0]),e==null)break;const t=e[1].length/2,i=e[2].trim();for(a(t,"t",e[2]),n.tag!=null?(o(t),l.html+=i):l.type==="text"&&l.html===""?l.html+=i:l.html+=" "+i,f=t;e=V.exec(i);){const s=l.html.length+e.index-i.length;l.refs.push({id:e[1],start:s,end:s+e[0].length})}break}}}o(0);const F=Array.from(k.values());function T(t){for(let i=t.refs.length-1;i>=0;i--){const s=t.refs[i];if(w.has(s.id)||!k.has(s.id))t.html=t.html.slice(0,s.start)+t.html.slice(s.end);else{const d=T(k.get(s.id));t.html=t.html.slice(0,s.start)+d.html+t.html.slice(s.end),d.type==="embed"&&w.add(d.id)}}return t.refs=[],t}for(let t=0;t<k.size+1;t++){let i;t===0&&m==null||(t===0?i=m:i=F[t-1],i.refs.length!==0&&T(i))}(m==null?void 0:m.html)!=null&&(h.root=m.html,h.selector="[data-lf-root]");for(let t=0;t<F.length;t++){let i;const s=F[t];s==null||w.has(s.id)||(s.type==="embed"?i=`[id=${s.id}]`:s.type==="bare"?i=`[data-lf=${s.id}]`:s.type==="range"&&(i=`[data-lf=${s.id}]`),h.fragments[s.id]={id:s.id,selector:i,type:s.type,html:s.html})}return h}const ee=/(?:#{([\w][\w\-_]*)})|(?:#\[([\w][\w\-_]+)\])/g;export function processTemplate(u,a,g){var p,c;const f=u.replace(ee,(x,n,b)=>{if(b!=null){const l=g(b);return l==null?"":l}return a[n]!=null?H(a[n].toString()):""});return(c=(p=Object.values(longform(f).fragments)[0])==null?void 0:p.html)!=null?c:null}
//# sourceMappingURL=longform.min.js.map
