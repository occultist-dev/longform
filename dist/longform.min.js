const R=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +([\["]).*)|(\ \ .*))$/gmi,C=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({{?|[^\n]+))?/gmi,L=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,U=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,K=/[ \t]*}}?[ \t]*/,w=/((?:\ \ )+)?#(#)?([\w\-]+)(?: ([\["]))?/gmi,B=/^(\ \ )+/,N=/^((?:\ \ )+)([^ \n][^\n]*)$/i,Q=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,V=/#\[([\w\-]+)\]/g,X=/([&<>"'#\[\]{}])/g,E=/^(\ \ )?([^\n]+)$/gmi,D=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let r,e,$;const Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};function G(o){return o.replace(X,u=>{var g;return(g=Y[u])!=null?g:u})}function W(o=0){return{indent:o,html:"",attrs:{}}}function H(o="bare"){return{type:o,html:"",template:!1,mountable:!1,els:[],refs:[],mountPoints:[]}}export function longform(o,u=()=>{}){var P,I,j,T,A,O,S,M,_,z,q;let g=!1,c=null,p=!0,d=null,x=!1,n=W(),t=H(),a=null;const y=new Set,b=new Map,m=Object.create(null);m.fragments=Object.create(null),m.templates=Object.create(null);function f(l){if(n.tag!=null){const i=t.type==="range"?l<2:t.html==="";t.html+=`<${n.tag}`,i&&(t.type==="root"?t.html+=" data-lf-root":(t.type==="bare"||t.type==="range")&&(t.html+=` data-lf="${t.id}"`)),n.mount!=null&&(t.html+=` data-lf-mount="${n.mount}"`),n.id!=null&&(t.html+=' id="'+n.id+'"'),n.class!=null&&(t.html+=' class="'+n.class+'"');for(const s of Object.entries(n.attrs))s[1]==null?t.html+=" "+s[0]:t.html+=` ${s[0]}="${s[1]}"`;t.html+=">",!D.has(n.tag)&&n.text!=null&&(t.html+=n.text),D.has(n.tag)||t.els.push(n)}if(l<=n.indent){for(n=W(l);t.els.length!==0&&(l==null||t.els[t.els.length-1].indent!==l-1);){const i=t.els.pop();t.html+=`</${i==null?void 0:i.tag}>`}l===0&&(u(0,"<",t.type,t.id),t.template?m.templates[t.id]=t.html:t.type==="root"?a=t:b.set(t.id,t),t=H())}else n=W(l)}for(;r=R.exec(o);)if(r[1]!=="--"){if(t.template&&(t.html+=r[0]),d!=null){B.lastIndex=0,e=B.exec(r[0]);const l=e==null?null:e[0].length/2;if(e==null||l<=d){if(t.html+=`
`,u(l,"}",e==null?void 0:e[0]),f(l),d=null,x=!1,c=l,K.test(r[0]))continue}else{const i=r[0].replace("  ".repeat(d+1),"");u(l,"{",i),n.tag!=null&&f(l),x?x=!1:t.html+=`
`,p?t.html+=G(i):t.html+=i;continue}}if(r[0].trim()!=="")switch((I=(P=r[2])!=null?P:r[3])!=null?I:r[4]){case"#":if(w.lastIndex=0,e=w.exec(r[0]),e!=null){const l=((T=(j=e[1])==null?void 0:j.length)!=null?T:0)/2;(n.tag!=null||c!=null)&&(f(l),c=null),u(l,"id",e[2],e[3],e[4]),t.id=e[3],l===0&&(e[4]=="["?t.type="range":e[4]==='"'?t.type="text":e[2]!=null?t.type="bare":(t.type="embed",n.id=t.id));break}case"@":case"[":case"::":{if(C.lastIndex=0,e=((A=r[2])!=null?A:r[4]!=null)?null:C.exec(r[0]),e!=null){const l=((S=(O=e[1])==null?void 0:O.length)!=null?S:0)/2,i=e[2],s=e[3],h=e[4]==="{"||e[4]==="{{",F=h?null:e[4];if(u(l,"e",i,h,F),(n.tag!=null||n.indent>l)&&f(l),n.indent=l,n.tag=i,c=null,l===0&&t.id==null&&(a!=null?g=!0:(t.type="root",a=t)),s!=null)for(u(l,"a",s);e=Q.exec(s);)e[1]==="#"?n.id=e[2]:e[1]==="."?n.class==null?n.class=e[2]:n.class+=" "+e[2]:e[3]==="id"?n.id==null&&(n.id=e[4]):e[3]==="class"?n.class==null?n.class=e[4]:n.class+=" "+e[4]:n.attrs[e[3]]=e[4];if(n.mount!=null){const J=n.mount;f(l+1),t.mountPoints.push({id:J,part:t.html}),t.html="",f(l);break}!h&&F!=null?n.text=F:h&&(x=!0,d=l,p=e[4]==="{");break}if(U.lastIndex=0,e=r[2]!=null?null:U.exec(r[0]),e!=null&&n.tag!=null){u("a",e[2],e[3]),e[2]==="id"?n.id==null&&(n.id=e[3].trim()):e[2]==="class"?n.class!=null?n.class+=" "+e[3].trim():n.class=e[3].trim():n.attrs[e[2]]!=null?n.attrs[e[2]]+=e[3]:n.attrs[e[2]]=e[3];break}if(L.lastIndex=0,e=r[3]!=null?null:L.exec(r[0]),e!=null){const l=((_=(M=e[1])==null?void 0:M.length)!=null?_:0)/2;switch((n.tag!=null||c!=null)&&f(l),u(l,"d",e[2],e[3]),e[2]){case"doctype":{t.html+=`<!doctype ${(z=e[3])!=null?z:"html"}>`;break}case"xml":{t.html+=`<?xml ${(q=e[3])!=null?q:'version="1.0" encoding="UTF-8"'}?>`;break}case"template":{let i=!1;for(t.template=l===0,E.lastIndex=R.lastIndex;e=E.exec(o);)if(e[1]==null&&!i&&t.id==null)w.lastIndex=0,$=w.exec(e[0]),$!=null&&(t.id=$[3]),t.html+=e[0];else if(e[1]==null&&i){R.lastIndex=E.lastIndex-e[0].length;break}else t.html+=`
`+e[0],e[1]!=null&&(i=!0);f(0);break}case"mount":{if(e[3]==null)throw new Error("Mount points must have a name");if(t.type!=="root")throw new Error("Mounting is only allowed on a root element");t.mountable=!0,n.mount=e[3].trim();break}}break}}default:{if(e=N.exec(r[0]),e==null)break;const l=e[1].length/2,i=e[2].trim();for(u(l,"t",e[2]),n.tag!=null?(f(l),t.html+=i):t.type==="text"&&t.html===""?t.html+=i:t.html+=" "+i,c=l;e=V.exec(i);){const s=t.html.length+e.index-i.length;t.refs.push({id:e[1],start:s,end:s+e[0].length})}break}}}f(0);const k=Array.from(b.values());function v(l){for(let i=l.refs.length-1;i>=0;i--){const s=l.refs[i];if(y.has(s.id)||!b.has(s.id))l.html=l.html.slice(0,s.start)+l.html.slice(s.end);else{const h=v(b.get(s.id));l.html=l.html.slice(0,s.start)+h.html+l.html.slice(s.end),h.type==="embed"&&y.add(h.id)}}return l.refs=[],l}if(a!=null&&a.mountable)return m.mountable=!0,m.tail=a.html,m.mountPoints=a.mountPoints,m;for(let l=0;l<b.size+1;l++){let i;l===0&&a==null||(l===0?i=a:i=k[l-1],i.refs.length!==0&&v(i))}(a==null?void 0:a.html)!=null&&(m.root=a.html,m.selector="[data-lf-root]");for(let l=0;l<k.length;l++){let i;const s=k[l];s==null||y.has(s.id)||(s.type==="embed"?i=`[id=${s.id}]`:s.type==="bare"?i=`[data-lf=${s.id}]`:s.type==="range"&&(i=`[data-lf=${s.id}]`),m.fragments[s.id]={id:s.id,selector:i,type:s.type,html:s.html})}return m}const Z=/(?:#{([\w][\w\-_]*)})|(?:#\[([\w][\w\-_]+)\])/g;export function processTemplate(o,u,g){var p,d;const c=o.replace(Z,(x,n,t)=>{if(t!=null){const a=g(t);return a==null?"":a}return u[n]!=null?G(u[n].toString()):""});return(d=(p=Object.values(longform(c).fragments)[0])==null?void 0:p.html)!=null?d:null}
//# sourceMappingURL=longform.min.js.map
