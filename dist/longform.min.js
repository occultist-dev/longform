export*from"./types";const G=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +(\[).*)|(\ \ .*))$/gmi,L=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({{?|[^\n]+))?/gmi,O=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,z=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,H=/[ \t]*}}?[ \t]*/,M=/((?:\ \ )+)?#(#)?([\w\-]+)( \[)?/gmi,q=/^(\ \ )+/,J=/^((?:\ \ )+)([^ \n][^\n]*)$/i,K=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,N=/#\[([\w\-]+)\]/g,U=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let r,e;function w(o=0){return{indent:o,html:"",attrs:{}}}function P(o="parsed"){return{type:o,html:"",els:[]}}function B(o="bare"){return{type:o,html:"",els:[],chunks:[],refs:[]}}export function longform(o,a=()=>{}){var F,$,E,v,C,R,T,j,A,S,I;let D=!1,m=null,y=!0,h=null,d=!1,t=w(),Q=P(),n=B(),c=null;const k=new Set,g=new Map,p=Object.create(null);p.fragments=Object.create(null);function f(l){if(t.tag!=null){const s=n.html==="";n.html+=`<${t.tag}`,s&&(n.type==="embed"||n.type==="range")&&(n.html+=` data-lf="${t.id}"`),t.id!=null&&(n.html+=' id="'+t.id+'"'),t.class!=null&&(n.html+=' class="'+t.class+'"');for(const i of Object.entries(t.attrs))i[1]==null?n.html+=" "+i[0]:n.html+=` ${i[0]}="${i[1]}"`;n.html+=">",!U.has(t.tag)&&t.text!=null&&(n.html+=t.text),U.has(t.tag)||n.els.push(t)}if(l<=t.indent){for(t=w(l);n.els.length!==0&&(l==null||n.els[n.els.length-1].indent!==l-1);){const s=n.els.pop();n.html+=`</${s==null?void 0:s.tag}>`}l===0&&(a(0,"<",n.type,n.id),n.type==="root"?c=n:g.set(n.id,n),n=B())}else t=w(l)}for(;r=G.exec(o);)if(r[1]!=="--"){if(h!=null){q.lastIndex=0,e=q.exec(r[0]);const l=e==null?null:e[0].length/2;if(e==null||l<=h){if(n.html+=`
`,a(l,"}",e==null?void 0:e[0]),f(l),h=null,d=!1,m=l,H.test(r[0]))continue}else{const s=r[0].replace("  ".repeat(h+1),"");a(l,"{",s),t.tag!=null&&f(l),d?d=!1:n.html+=`
`,y?n.html+=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):n.html+=s;continue}}if(r[0].trim()!=="")switch(($=(F=r[2])!=null?F:r[3])!=null?$:r[4]){case"#":if(M.lastIndex=0,e=M.exec(r[0]),e!=null){const l=((v=(E=e[1])==null?void 0:E.length)!=null?v:0)/2;(t.tag!=null||m!=null)&&(f(l),m=null),a(l,"id",e[2],e[3],e[4]),n.id=e[3],l===0&&(e[4]!=null?n.type="range":e[2]!=null?n.type="bare":(n.type="embed",t.id=n.id));break}case"@":case"[":case"::":{if(L.lastIndex=0,e=((C=r[2])!=null?C:r[4]!=null)?null:L.exec(r[0]),e!=null){const l=((T=(R=e[1])==null?void 0:R.length)!=null?T:0)/2,s=e[2],i=e[3],u=e[4]==="{"||e[4]==="{{",b=u?null:e[4];if(a(l,"e",s,u,b),(t.tag!=null||t.indent>l)&&f(l),t.indent=l,t.tag=s,m=null,l===0&&n.id==null&&(c!=null?D=!0:(n.type="root",c=n)),i!=null)for(a(l,"a",i);e=K.exec(i);)e[1]==="#"?t.id=e[2]:e[1]==="."?t.class==null?t.class=e[2]:t.class+=" "+e[2]:e[3]==="id"?t.id==null&&(t.id=e[4]):e[3]==="class"?t.class==null?t.class=e[4]:t.class+=" "+e[4]:t.attrs[e[3]]=e[4];!u&&b!=null?t.text=b:u&&(d=!0,h=l,y=e[4]==="{");break}if(z.lastIndex=0,e=r[2]!=null?null:z.exec(r[0]),e!=null&&t.tag!=null){a("a",e[2],e[3]),e[2]==="id"?t.id==null&&(t.id=e[3].trim()):e[2]==="class"?t.class!=null?t.class+=" "+e[3].trim():t.class=e[3].trim():t.attrs[e[2]]!=null?t.attrs[e[2]]+=e[3]:t.attrs[e[2]]=e[3];break}if(O.lastIndex=0,e=r[3]!=null?null:O.exec(r[0]),e!=null){const l=((A=(j=e[1])==null?void 0:j.length)!=null?A:0)/2;switch((t.tag!=null||m!=null)&&f(l),a(l,"d",e[2],e[3]),e[2]){case"doctype":{n.html+=`<!doctype ${(S=e[3])!=null?S:"html"}>`;break}case"xml":{n.html+=`<?xml ${(I=e[3])!=null?I:'version="1.0" encoding="UTF-8"'}?>`;break}}break}}default:{if(e=J.exec(r[0]),e==null)break;const l=e[1].length/2,s=e[2].trim();for(a(l,"t",e[2]),t.tag!=null?(f(l),n.html+=s):n.html+=" "+s,m=l;e=N.exec(s);){const i=n.html.length+e.index-s.length;n.refs.push({id:e[1],start:i,end:i+e[0].length})}break}}}f(0);const x=Array.from(g.values());function W(l){for(let s=l.refs.length-1;s>=0;s--){const i=l.refs[s];if(k.has(i.id)||!g.has(i.id))l.html=l.html.slice(0,i.start)+l.html.slice(i.end);else{const u=W(g.get(i.id));l.html=l.html.slice(0,i.start)+u.html+l.html.slice(i.end),u.type==="embed"&&k.add(u.id)}}return l.refs=[],l}for(let l=0;l<g.size+1;l++){let s;l===0&&c==null||(l===0?s=c:s=x[l-1],s.refs.length!==0&&W(s))}c.html!=null&&(p.root=c.html);for(let l=0;l<x.length;l++){let s;const i=x[l];i==null||k.has(i.id)||(i.type==="embed"?s=`[id=${i.id}]`:i.type==="bare"?s=`[data-lf=${i.id}]`:i.type==="range"&&(s=`[data-lf=${i.id}]`),p.fragments[i.id]={id:i.id,selector:s,type:i.type,html:i.html})}return p}
//# sourceMappingURL=longform.min.js.map
