export*from"./types.ts";const G=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +(\[).*)|(\ \ .*))$/gmi,P=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({{?|[^\n]+))?/gmi,z=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,I=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,H=/[ \t]*}}?[ \t]*/,M=/((?:\ \ )+)?#(#)?([\w\-]+)( \[)?/gmi,q=/^(\ \ )+/,J=/^((?:\ \ )+)([^ \n][^\n]*)$/i,K=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,L=/#\[([\w\-]+)\]/g,U=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let r,e;function y(f=0){return{indent:f,html:"",attrs:{}}}function N(f="parsed"){return{type:f,html:"",els:[]}}function B(f="bare"){return{type:f,html:"",els:[],chunks:[],refs:[]}}export function longform(f,a=()=>{}){var F,$,E,R,v,C,T,j,A,S,O;let D=!1,m=null,w=!0,h=null,p=!1,n=y(),Q=N(),t=B(),u=null;const k=new Set,d=new Map,g=Object.create(null);g.fragments=Object.create(null);function o(l){if(n.tag!=null){const s=t.type==="range"?l<2:t.html==="";t.html+=`<${n.tag}`,s&&(t.type==="root"?t.html+=" data-lf-root":(t.type==="bare"||t.type==="range")&&(t.html+=` data-lf="${t.id}"`)),n.id!=null&&(t.html+=' id="'+n.id+'"'),n.class!=null&&(t.html+=' class="'+n.class+'"');for(const i of Object.entries(n.attrs))i[1]==null?t.html+=" "+i[0]:t.html+=` ${i[0]}="${i[1]}"`;t.html+=">",!U.has(n.tag)&&n.text!=null&&(t.html+=n.text),U.has(n.tag)||t.els.push(n)}if(l<=n.indent){for(n=y(l);t.els.length!==0&&(l==null||t.els[t.els.length-1].indent!==l-1);){const s=t.els.pop();t.html+=`</${s==null?void 0:s.tag}>`}l===0&&(a(0,"<",t.type,t.id),t.type==="root"?u=t:d.set(t.id,t),t=B())}else n=y(l)}for(;r=G.exec(f);)if(r[1]!=="--"){if(h!=null){q.lastIndex=0,e=q.exec(r[0]);const l=e==null?null:e[0].length/2;if(e==null||l<=h){if(t.html+=`
`,a(l,"}",e==null?void 0:e[0]),o(l),h=null,p=!1,m=l,H.test(r[0]))continue}else{const s=r[0].replace("  ".repeat(h+1),"");a(l,"{",s),n.tag!=null&&o(l),p?p=!1:t.html+=`
`,w?t.html+=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):t.html+=s;continue}}if(r[0].trim()!=="")switch(($=(F=r[2])!=null?F:r[3])!=null?$:r[4]){case"#":if(M.lastIndex=0,e=M.exec(r[0]),e!=null){const l=((R=(E=e[1])==null?void 0:E.length)!=null?R:0)/2;(n.tag!=null||m!=null)&&(o(l),m=null),a(l,"id",e[2],e[3],e[4]),t.id=e[3],l===0&&(e[4]!=null?t.type="range":e[2]!=null?t.type="bare":(t.type="embed",n.id=t.id));break}case"@":case"[":case"::":{if(P.lastIndex=0,e=((v=r[2])!=null?v:r[4]!=null)?null:P.exec(r[0]),e!=null){const l=((T=(C=e[1])==null?void 0:C.length)!=null?T:0)/2,s=e[2],i=e[3],c=e[4]==="{"||e[4]==="{{",b=c?null:e[4];if(a(l,"e",s,c,b),(n.tag!=null||n.indent>l)&&o(l),n.indent=l,n.tag=s,m=null,l===0&&t.id==null&&(u!=null?D=!0:(t.type="root",u=t)),i!=null)for(a(l,"a",i);e=K.exec(i);)e[1]==="#"?n.id=e[2]:e[1]==="."?n.class==null?n.class=e[2]:n.class+=" "+e[2]:e[3]==="id"?n.id==null&&(n.id=e[4]):e[3]==="class"?n.class==null?n.class=e[4]:n.class+=" "+e[4]:n.attrs[e[3]]=e[4];!c&&b!=null?n.text=b:c&&(p=!0,h=l,w=e[4]==="{");break}if(I.lastIndex=0,e=r[2]!=null?null:I.exec(r[0]),e!=null&&n.tag!=null){a("a",e[2],e[3]),e[2]==="id"?n.id==null&&(n.id=e[3].trim()):e[2]==="class"?n.class!=null?n.class+=" "+e[3].trim():n.class=e[3].trim():n.attrs[e[2]]!=null?n.attrs[e[2]]+=e[3]:n.attrs[e[2]]=e[3];break}if(z.lastIndex=0,e=r[3]!=null?null:z.exec(r[0]),e!=null){const l=((A=(j=e[1])==null?void 0:j.length)!=null?A:0)/2;switch((n.tag!=null||m!=null)&&o(l),a(l,"d",e[2],e[3]),e[2]){case"doctype":{t.html+=`<!doctype ${(S=e[3])!=null?S:"html"}>`;break}case"xml":{t.html+=`<?xml ${(O=e[3])!=null?O:'version="1.0" encoding="UTF-8"'}?>`;break}}break}}default:{if(e=J.exec(r[0]),e==null)break;const l=e[1].length/2,s=e[2].trim();for(a(l,"t",e[2]),n.tag!=null?(o(l),t.html+=s):t.html+=" "+s,m=l;e=L.exec(s);){const i=t.html.length+e.index-s.length;t.refs.push({id:e[1],start:i,end:i+e[0].length})}break}}}o(0);const x=Array.from(d.values());function W(l){for(let s=l.refs.length-1;s>=0;s--){const i=l.refs[s];if(k.has(i.id)||!d.has(i.id))l.html=l.html.slice(0,i.start)+l.html.slice(i.end);else{const c=W(d.get(i.id));l.html=l.html.slice(0,i.start)+c.html+l.html.slice(i.end),c.type==="embed"&&k.add(c.id)}}return l.refs=[],l}for(let l=0;l<d.size+1;l++){let s;l===0&&u==null||(l===0?s=u:s=x[l-1],s.refs.length!==0&&W(s))}(u==null?void 0:u.html)!=null&&(g.root=u.html,g.selector="[data-lf-root]");for(let l=0;l<x.length;l++){let s;const i=x[l];i==null||k.has(i.id)||(i.type==="embed"?s=`[id=${i.id}]`:i.type==="bare"?s=`[data-lf=${i.id}]`:i.type==="range"&&(s=`[data-lf=${i.id}]`),g.fragments[i.id]={id:i.id,selector:s,type:i.type,html:i.html})}return g}
//# sourceMappingURL=longform.min.js.map
