const U=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +(\[).*)|(\ \ .+))$/gmi,v=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({|[^\n]+))?/gmi,R=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,j=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,q=/[ \t]*}[ \t]*/,A=/((?:\ \ )+)?#(#)?([\w\-]+)( \[)?/gmi,L=/^(\ \ )+/,z=/^((?:\ \ )+)([^ \n][^\n]*)$/i,B=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,O=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let s,e;function d(r=0){return{indent:r,html:"",attrs:{}}}function D(r="parsed"){return{type:r,html:"",els:[]}}function I(r="bare"){return{type:r,html:"",els:[],chunks:[]}}export function longform(r,a=()=>{}){var k,x,w,b,y,E,F,W,$,C,T;let p=!1,S=!1,m=null,f=!1,l=d(),G=D(),n=I();const o=Object.create(null);o.fragments=Object.create(null);function u(t){if(l.tag!=null){n.html+=`<${l.tag}`,l.id!=null&&(n.html+=' id="'+l.id+'"'),l.class!=null&&(n.html+=' class="'+l.class+'"');for(const i of Object.entries(l.attrs))i[1]==null?n.html+=" "+i[0]:n.html+=` ${i[0]}="${i[1]}"`;n.html+=">",!O.has(l.tag)&&l.text!=null&&(n.html+=l.text),O.has(l.tag)||n.els.push(l)}if(t<=l.indent){for(l=d(t);n.els.length!==0&&(t==null||n.els[n.els.length-1].indent!==t-1);){const i=n.els.pop();n.html+=`</${i==null?void 0:i.tag}>`}t===0&&(a(0,"<",n.type,n.id),n.type==="root"?o.root=n.html:o.fragments[n.id]={type:n.type,id:n.id,html:n.html},n=I())}else l=d(t)}for(;s=U.exec(r);)if(s[1]!=="--"){if(m!=null){L.lastIndex=0,e=L.exec(s[0]);const t=e==null?null:e[0].length/2;if(e==null||t<=m){if(n.html+=`
`,a(t,"}",e==null?void 0:e[0]),u(m),m=null,q.test(s[0]))continue}else{const i=s[0].replace("  ".repeat(m+1),"");a(t,"{",i),l.tag!=null&&u(t),f?f=!0:n.html+=`
`,n.html+=i;continue}}switch((x=(k=s[2])!=null?k:s[3])!=null?x:s[4]){case"#":if(A.lastIndex=0,e=A.exec(s[0]),e!=null){const t=((b=(w=e[1])==null?void 0:w.length)!=null?b:0)/2;a(t,"id",e[2],e[3],e[4]),l.tag!=null&&u(t),n.id=e[3],t===0&&(e[4]!=null?n.type="range":e[2]!=null?n.type="bare":(n.type="embed",l.id=n.id));break}case"@":case"[":case"::":{if(v.lastIndex=0,e=((y=s[2])!=null?y:s[4]!=null)?null:v.exec(s[0]),e!=null){const t=((F=(E=e[1])==null?void 0:E.length)!=null?F:0)/2,i=e[2],g=e[3],c=e[4]==="{",h=c?null:e[4];if(a(t,"e",i,c,h),(l.tag!=null||l.indent>t)&&u(t),t===0&&n.id==null&&(p?S=!0:(n.type="root",p=!0)),l.indent=t,l.tag=i,g!=null)for(a(t,"a",g);e=B.exec(g);)e[1]==="#"?l.id=e[2]:e[1]==="."?l.class==null?l.class=e[2]:l.class+=" "+e[2]:e[3]==="id"?l.id==null&&(l.id=e[4]):e[3]==="class"?l.class==null?l.class=e[4]:l.class+=" "+e[4]:l.attrs[e[3]]=e[4];!c&&h!=null?l.text=h:c&&(f=!0,m=t);break}if(j.lastIndex=0,e=s[2]!=null?null:j.exec(s[0]),e!=null&&l.tag!=null){a("a",e[2],e[3]),e[2]==="id"?l.id==null&&(l.id=e[3].trim()):e[2]==="class"?l.class!=null?l.class+=" "+e[3].trim():l.class=e[3].trim():l.attrs[e[2]]!=null?l.attrs[e[2]]+=e[3]:l.attrs[e[2]]=e[3];break}if(R.lastIndex=0,e=s[3]!=null?null:R.exec(s[0]),e!=null){const t=(($=(W=e[1])==null?void 0:W.length)!=null?$:0)/2;switch(l.tag!=null&&u(t),e[2]){case"doctype":{n.html+=`<!doctype ${(C=e[3])!=null?C:"html"}>`;break}case"xml":{n.html+=`<?xml ${(T=e[3])!=null?T:'version="1.0" encoding="UTF-8"'}?>`;break}}break}}default:{const t=z.exec(s[0]);if(t==null)break;const i=t[1].length/2;a(i,"t",t[2]),l.tag!=null?(u(i),n.html+=t[2].trim()):n.html+=" "+t[2].trim();break}}}return u(0),o}
//# sourceMappingURL=longform.min.js.map
