const D=/^(?:(?:(--).*)|(?: *(@|#).*)|(?: *[\w\-]+(?::[\w\-]+)?(?:[#.[][^\n]+)?(::).*)|(?:  +(\[).*)|(\ \ .+))$/gmi,L=/((?:\ \ )+)? ?([\w\-]+(?::[\w\-]+)?)([#\.\[][^\n]*)?::(?: ({|[^\n]+))?/gmi,O=/((?:\ \ )+)? ?@([\w][\w\-]+)(?::: ?([^\n]+)?)?/gmi,S=/((?:\ \ )+)\[(\w[\w-]*(?::\w[\w-]*)?)(?:=([^\n]+))?\]/,G=/[ \t]*}[ \t]*/,M=/((?:\ \ )+)?#(#)?([\w\-]+)( \[)?/gmi,z=/^(\ \ )+/,H=/^((?:\ \ )+)([^ \n][^\n]*)$/i,J=/(?:(#|\.)([^#.\[\n]+)|(?:\[(\w[\w\-]*(?::\w[\w\-]*)?)(?:=([^\n\]]+))?\]))/g,K=/#\[([\w\-]+)\]/g,U=new Set(["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wrb"]);let s,e;function b(o=0){return{indent:o,html:"",attrs:{}}}function N(o="parsed"){return{type:o,html:"",els:[]}}function q(o="bare"){return{type:o,html:"",els:[],chunks:[],refs:[]}}export function longform(o,a=()=>{}){var W,F,E,$,v,C,R,T,j,A,I;let B=!1,h=null,m=null,d=!1,n=b(),P=N(),t=q(),c=null;const k=new Set,g=new Map,p=Object.create(null);p.fragments=Object.create(null);function f(l){if(n.tag!=null){t.html+=`<${n.tag}`,n.id!=null&&(t.html+=' id="'+n.id+'"'),n.class!=null&&(t.html+=' class="'+n.class+'"');for(const i of Object.entries(n.attrs))i[1]==null?t.html+=" "+i[0]:t.html+=` ${i[0]}="${i[1]}"`;t.html+=">",!U.has(n.tag)&&n.text!=null&&(t.html+=n.text),U.has(n.tag)||t.els.push(n)}if(l<=n.indent){for(n=b(l);t.els.length!==0&&(l==null||t.els[t.els.length-1].indent!==l-1);){const i=t.els.pop();t.html+=`</${i==null?void 0:i.tag}>`}l===0&&(a(0,"<",t.type,t.id),t.type==="root"?c=t:g.set(t.id,t),t=q())}else n=b(l)}for(;s=D.exec(o);)if(s[1]!=="--"){if(m!=null){z.lastIndex=0,e=z.exec(s[0]);const l=e==null?null:e[0].length/2;if(e==null||l<=m){if(t.html+=`
`,a(l,"}",e==null?void 0:e[0]),f(m),m=null,d=!1,G.test(s[0]))continue}else{const i=s[0].replace("  ".repeat(m+1),"");a(l,"{",i),n.tag!=null&&f(l),d?d=!0:t.html+="\\n",t.html+=i;continue}}switch((F=(W=s[2])!=null?W:s[3])!=null?F:s[4]){case"#":if(M.lastIndex=0,e=M.exec(s[0]),e!=null){const l=(($=(E=e[1])==null?void 0:E.length)!=null?$:0)/2;a(l,"id",e[2],e[3],e[4]),(n.tag!=null||h!=null)&&f(l),h=null,t.id=e[3],l===0&&(e[4]!=null?t.type="range":e[2]!=null?t.type="bare":(t.type="embed",n.id=t.id));break}case"@":case"[":case"::":{if(L.lastIndex=0,e=((v=s[2])!=null?v:s[4]!=null)?null:L.exec(s[0]),e!=null){const l=((R=(C=e[1])==null?void 0:C.length)!=null?R:0)/2,i=e[2],r=e[3],u=e[4]==="{",w=u?null:e[4];if(a(l,"e",i,u,w),(n.tag!=null||n.indent>l)&&f(l),n.indent=l,n.tag=i,h=null,l===0&&t.id==null&&(c!=null?B=!0:(t.type="root",c=t)),r!=null)for(a(l,"a",r);e=J.exec(r);)e[1]==="#"?n.id=e[2]:e[1]==="."?n.class==null?n.class=e[2]:n.class+=" "+e[2]:e[3]==="id"?n.id==null&&(n.id=e[4]):e[3]==="class"?n.class==null?n.class=e[4]:n.class+=" "+e[4]:n.attrs[e[3]]=e[4];!u&&w!=null?n.text=w:u&&(d=!0,m=l);break}if(S.lastIndex=0,e=s[2]!=null?null:S.exec(s[0]),e!=null&&n.tag!=null){a("a",e[2],e[3]),e[2]==="id"?n.id==null&&(n.id=e[3].trim()):e[2]==="class"?n.class!=null?n.class+=" "+e[3].trim():n.class=e[3].trim():n.attrs[e[2]]!=null?n.attrs[e[2]]+=e[3]:n.attrs[e[2]]=e[3];break}if(O.lastIndex=0,e=s[3]!=null?null:O.exec(s[0]),e!=null){const l=((j=(T=e[1])==null?void 0:T.length)!=null?j:0)/2;switch((n.tag!=null||h!=null)&&f(l),a(l,"d",e[2],e[3]),e[2]){case"doctype":{t.html+=`<!doctype ${(A=e[3])!=null?A:"html"}>`;break}case"xml":{t.html+=`<?xml ${(I=e[3])!=null?I:'version="1.0" encoding="UTF-8"'}?>`;break}}break}}default:{if(e=H.exec(s[0]),e==null)break;const l=e[1].length/2,i=e[2].trim();for(a(l,"t",e[2]),n.tag!=null?(f(l),h=l,t.html+=i):t.html+=" "+i;e=K.exec(i);){const r=t.html.length+e.index-i.length;t.refs.push({id:e[1],start:r,end:r+e[0].length})}break}}}f(0);const x=Array.from(g.values());function y(l){for(let i=l.refs.length-1;i>=0;i--){const r=l.refs[i];if(k.has(r.id)&&(l.html=l.html.slice(0,r.start)+l.html.slice(r.start+r.end)),g.has(r.id)){const u=y(g.get(r.id));l.html=l.html.slice(0,r.start)+u.html+l.html.slice(r.end),u.type==="embed"&&k.add(u.id)}}return l.refs=[],l}for(let l=0;l<g.size+1;l++){let i;l===0&&c==null||(l===0?i=c:i=x[l-1],i.refs.length!==0&&y(i))}c.html!=null&&(p.root=c.html);for(let l=0;l<x.length;l++){const i=x[l];i==null||k.has(i.id)||(p.fragments[i.id]={id:i.id,type:i.type,html:i.html})}return p}
//# sourceMappingURL=longform.min.js.map
